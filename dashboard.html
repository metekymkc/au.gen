<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mete's Admin Konsole</title>
    <style>
        :root {
            --bg: #09090b;
            --card: #18181b;
            --text: #f4f4f5;
            --text-muted: #a1a1aa;
            --accent: #3b82f6;
            --border: #27272a;
            --danger: #ef4444;
        }
        body {
            background-color: var(--bg); color: var(--text);
            font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px;
        }
        .container { max-width: 1000px; margin: 0 auto; }
        
        /* Header */
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; border-bottom: 1px solid var(--border); padding-bottom: 20px; }
        h1 { margin: 0; font-size: 1.5rem; letter-spacing: -0.5px; }
        .badge { background: #27272a; padding: 5px 10px; border-radius: 6px; font-size: 0.8rem; color: var(--accent); }

        /* Login Modal */
        #login-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 1000;
            display: flex; justify-content: center; align-items: center;
        }
        .login-box {
            background: var(--card); padding: 30px; border-radius: 12px; border: 1px solid var(--border);
            text-align: center; width: 300px;
        }
        .login-box input {
            width: 100%; padding: 10px; margin-top: 15px; margin-bottom: 15px;
            background: var(--bg); border: 1px solid var(--border); color: white; border-radius: 6px;
        }
        .btn {
            background: var(--accent); color: white; border: none; padding: 10px 20px;
            border-radius: 6px; cursor: pointer; font-weight: 600;
        }
        .btn:hover { opacity: 0.9; }

        /* Grid Layout */
        .dashboard-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; }
        @media(max-width: 768px) { .dashboard-grid { grid-template-columns: 1fr; } }

        /* Panels */
        .panel { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 20px; overflow: hidden; }
        .panel h2 { margin-top: 0; font-size: 1.1rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; }

        /* File List */
        .file-list { list-style: none; padding: 0; max-height: 500px; overflow-y: auto; }
        .file-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 10px 0; border-bottom: 1px solid #27272a; font-size: 0.9rem;
        }
        .file-item:last-child { border: none; }
        .file-name { color: var(--text); text-decoration: none; display: flex; align-items: center; gap: 10px; }
        .file-name:hover { color: var(--accent); }
        .file-meta { font-size: 0.75rem; color: #52525b; margin-right: 10px; }
        
        .icon-pdf { color: #ef4444; }
        .icon-json { color: #eab308; }

        .btn-sm { padding: 4px 8px; font-size: 0.75rem; background: #27272a; border: 1px solid var(--border); }
        .btn-del:hover { background: var(--danger); border-color: var(--danger); }

        /* Tasks */
        .task-input-group { display: flex; gap: 10px; margin-bottom: 15px; }
        .task-input-group input { flex: 1; background: var(--bg); border: 1px solid var(--border); color: white; padding: 8px; border-radius: 6px; }
        
        .task-list { list-style: none; padding: 0; }
        .task-item { display: flex; align-items: center; gap: 10px; padding: 8px 0; border-bottom: 1px solid #27272a; }
        .task-item.done span { text-decoration: line-through; color: var(--text-muted); }
        .checkbox { width: 18px; height: 18px; accent-color: var(--accent); cursor: pointer; }
        .delete-task { margin-left: auto; cursor: pointer; color: #52525b; }
        .delete-task:hover { color: var(--danger); }

    </style>
</head>
<body>

    <div id="login-modal">
        <div class="login-box">
            <h3>Admin Zugang</h3>
            <input type="password" id="passwordInput" placeholder="Passwort eingeben">
            <button class="btn" onclick="login()">Login</button>
        </div>
    </div>

    <div class="container">
        <header>
            <h1>Mete's Dashboard</h1>
            <div class="badge">SECURE MODE</div>
        </header>

        <div class="dashboard-grid">
            <div class="panel">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <h2>Generierte Dateien</h2>
                    <button class="btn btn-sm" onclick="loadFiles()">‚Üª Refresh</button>
                </div>
                <ul class="file-list" id="fileList">
                    <li style="text-align:center; padding:20px; color:#52525b;">Lade Dateien...</li>
                </ul>
            </div>

            <div class="panel">
                <h2>To-Do Liste</h2>
                <div class="task-input-group">
                    <input type="text" id="newTaskInput" placeholder="Neue Aufgabe...">
                    <button class="btn btn-sm" onclick="addTask()">+</button>
                </div>
                <ul class="task-list" id="taskList"></ul>
            </div>
        </div>
    </div>

    <script>
        const WORKER_URL = "https://pdf-worker.metekymkc.workers.dev"; // Anpassen falls n√∂tig
        let AUTH_KEY = "";

        // --- LOGIN ---
        function login() {
            const input = document.getElementById('passwordInput').value;
            AUTH_KEY = input;
            // Testen ob Passwort stimmt indem wir Liste laden
            loadFiles(true);
        }

        // --- FILES ---
        async function loadFiles(isLoginAttempt = false) {
            try {
                const res = await fetch(`${WORKER_URL}/admin/list`, {
                    headers: { 'x-admin-auth': AUTH_KEY }
                });

                if (res.status === 401) {
                    if(isLoginAttempt) alert("Falsches Passwort!");
                    return;
                }

                // Login erfolgreich
                document.getElementById('login-modal').style.display = 'none';
                
                const data = await res.json();
                const list = document.getElementById('fileList');
                list.innerHTML = "";

                // Nur PDFs anzeigen, JSONs filtern wir visuell raus oder zeigen sie anders
                const files = data.objects.sort((a,b) => new Date(b.uploaded) - new Date(a.uploaded)); // Neueste zuerst

                files.forEach(file => {
                    const isPdf = file.key.endsWith('.pdf');
                    const icon = isPdf ? 'üìÑ' : 'üìù';
                    
                    // Gr√∂√üe formatieren
                    const sizeKB = (file.size / 1024).toFixed(1) + ' KB';
                    
                    // Zeit
                    const date = new Date(file.uploaded).toLocaleString('de-DE');

                    const li = document.createElement('li');
                    li.className = 'file-item';
                    li.innerHTML = `
                        <a href="#" onclick="downloadFile('${file.key}')" class="file-name">
                            <span>${icon}</span>
                            <span>${file.key}</span>
                        </a>
                        <div style="display:flex; align-items:center; gap:10px;">
                            <span class="file-meta">${date} | ${sizeKB}</span>
                            <button class="btn btn-sm btn-del" onclick="deleteFile('${file.key}')">‚úï</button>
                        </div>
                    `;
                    list.appendChild(li);
                });
                
                // Tasks auch laden wenn Login erfolgreich
                if(isLoginAttempt) loadTasks();

            } catch (e) {
                console.error(e);
            }
        }

        async function downloadFile(key) {
            window.open(`${WORKER_URL}/admin/get?key=${encodeURIComponent(key)}`, '_blank');
        }

        async function deleteFile(key) {
            if(!confirm(`Wirklich l√∂schen?\n${key}`)) return;
            await fetch(`${WORKER_URL}/admin/delete?key=${encodeURIComponent(key)}`, {
                method: 'DELETE',
                headers: { 'x-admin-auth': AUTH_KEY }
            });
            loadFiles(); // Refresh
        }

        // --- TASKS ---
        let tasks = [];

        async function loadTasks() {
            try {
                const res = await fetch(`${WORKER_URL}/admin/tasks`, {
                    headers: { 'x-admin-auth': AUTH_KEY }
                });
                tasks = await res.json();
                renderTasks();
            } catch(e) { console.log("No tasks yet"); }
        }

        async function saveTasks() {
            await fetch(`${WORKER_URL}/admin/tasks`, {
                method: 'POST',
                headers: { 'x-admin-auth': AUTH_KEY, 'Content-Type': 'application/json' },
                body: JSON.stringify(tasks)
            });
        }

        function renderTasks() {
            const list = document.getElementById('taskList');
            list.innerHTML = "";
            tasks.forEach((task, index) => {
                const li = document.createElement('li');
                li.className = `task-item ${task.done ? 'done' : ''}`;
                li.innerHTML = `
                    <input type="checkbox" class="checkbox" ${task.done ? 'checked' : ''} onchange="toggleTask(${index})">
                    <span>${task.text}</span>
                    <span class="delete-task" onclick="removeTask(${index})">üóëÔ∏è</span>
                `;
                list.appendChild(li);
            });
        }

        function addTask() {
            const input = document.getElementById('newTaskInput');
            if(!input.value) return;
            tasks.push({ text: input.value, done: false });
            input.value = "";
            renderTasks();
            saveTasks();
        }

        function toggleTask(index) {
            tasks[index].done = !tasks[index].done;
            renderTasks();
            saveTasks();
        }

        function removeTask(index) {
            tasks.splice(index, 1);
            renderTasks();
            saveTasks();
        }
        
        // Enter Taste f√ºr Tasks
        document.getElementById('newTaskInput').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') addTask();
        });
        
        // Enter Taste f√ºr Login
        document.getElementById('passwordInput').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') login();
        });

    </script>
</body>
</html>